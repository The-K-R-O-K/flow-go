name: Ephemeral-Benchnet2-Setup-Teardown

on:
  pull_request:
    branches:
      - master
      - 'auto-cadence-upgrade/**'
      - 'feature/**'
      - 'v[0-9]+.[0-9]+'

env:
  GO_VERSION: 1.19

jobs:
  create-kubernetes-env:
    name: Create Kubernetes Containers
    runs-on: ubuntu-latest
    steps:
      - name: Create containers
        # uses: helm command
    name: Push to container registry
    runs-on: ubuntu-latest
    steps:
    - name: Setup Go
      uses: actions/setup-go@v3
      with:
        go-version: '1.19'
    - name: Checkout repo
      uses: actions/checkout@v3
    - name: Build relic
      run: make crypto_setup_gopath
    # Provide Google Service Account credentials to Github Action, allowing interaction with the Google Container Registry
    # Logging in as github-actions@dl-flow.iam.gserviceaccount.com
    - name: Docker login
      uses: docker/login-action@v1
      with:
        registry: gcr.io
        username: _json_key
        password: ${{ secrets.GCR_SERVICE_KEY }}
    - name: Docker build
      run: make docker-build-flow
    - name: Docker push
      run: make docker-push-flow
    name: Deploy Branch Docker Images
    runs-on: ubuntu-latest
    steps:
      - name: Deploy containers
        # uses: kubernetes command
    name: Setup E2E Testroot Account
    runs-on: ubuntu-latest
    steps:
      - name: setup account
        # uses: flow CLI command
      - name: add flow tokens
        # uses: flow CLI command
    name: Teardown
    runs-on: ubuntu-latest
    steps:
      - name: stop network
       # uses: kubernetes command
      - name: turn off machines
       # uses: helm